<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Layer Visibility URL Generator</title>
  <script src="https://js.arcgis.com/4.19/"></script>
  <style>
    #shareLink {
      width: 100%;
      padding: 10px;
      font-size: 16px;
    }
    #generateLinkButton {
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div id="viewDiv" style="height: 400px;"></div>
  <input type="text" id="shareLink" placeholder="Generated URL will appear here" readonly>
  <button id="generateLinkButton">Generate Shareable Link</button>

  <script>
    require([
      "esri/Map",
      "esri/views/MapView",
      "esri/layers/FeatureLayer"
    ], function(Map, MapView, FeatureLayer) {
      
      const map = new Map({
        basemap: "topo-vector"
      });

      const view = new MapView({
        container: "viewDiv",
        map: map,
        center: [-82.1, 29.2], // Adjust to your location
        zoom: 10
      });

      // Add layers
      const layers = [
        new FeatureLayer({ url: "https://gis.marionfl.org/server/rest/services/Onemap/Parcels_withCF/MapServer", id: "Parcels" }),
        new FeatureLayer({ url: "https://gis.marionfl.org/server/rest/services/Onemap/Parcels_withCF/MapServer/2", id: "Subdivisions" }),
        new FeatureLayer({ url: "https://gis.marionfl.org/server/rest/services/Onemap/Addressing/MapServer", id: "Addressing" }),
        new FeatureLayer({ url: "https://gis.marionfl.org/server/rest/services/Onemap/Boundaries_MarionBoundaryforonemap/MapServer", id: "CountyBoundaries" }),
        new FeatureLayer({ url: "https://marioncountyfl.maps.arcgis.com/home/item.html?id=99059745ff81489695dbb6dcb27bb070&view=service", id: "FPA" }),
        new FeatureLayer({ url: "https://gis.marionfl.org/server/rest/services/Onemap/Boundaries_MarionBoundaryforonemap/MapServer/4", id: "FarmlandPreservationArea" }),
        new FeatureLayer({ url: "https://gis.marionfl.org/server/rest/services/Onemap/Boundaries_MarionBoundaryforonemap/MapServer/5", id: "UrbanGrowthBoundary" }),
        new FeatureLayer({ url: "https://gis.marionfl.org/server/rest/services/Onemap/Contours/MapServer", id: "Contours" })
      ];

      layers.forEach(layer => map.add(layer));

      document.getElementById('generateLinkButton').addEventListener('click', () => {
        const visibleLayers = [];
        const hiddenLayers = [];
        
        layers.forEach(layer => {
          if (layer.visible) {
            visibleLayers.push(layer.id);
          } else {
            hiddenLayers.push(layer.id);
          }
        });

        const baseURL = window.location.href.split('?')[0];
        const urlParams = new URLSearchParams();
        if (visibleLayers.length) {
          urlParams.set('showLayers', visibleLayers.join(';'));
        }
        if (hiddenLayers.length) {
          urlParams.set('hideLayers', hiddenLayers.join(';'));
        }

        const shareURL = `${baseURL}?${urlParams.toString()}`;
        document.getElementById('shareLink').value = shareURL;
      });
    });
  </script>
</body>
</html>
